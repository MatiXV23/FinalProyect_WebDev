<main class="md:m-4 lg:m-6 xl:m-10 h-full">
    <form class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3">
        <div class="flex">
            @if (this.departamentos.hasValue()) {
                <ion-select
                (ngModelChange)="this.articulos.reload()"
                [(ngModel)]="this.params['id_departamento']"
                name="id_departamento"
                label="Departamento"
                label-placement="stacked"
                type="select"
                class="mr-5 w-1/3" 
                >
                    <ion-select-option [value]="null">Todos</ion-select-option>
                    @for (depto of departamentos.value(); track $index) {
                        <ion-select-option [value]="depto.id_departamento">{{ depto.nombre }}</ion-select-option>
                    }
                </ion-select>
            }

            @if (this.categorias.hasValue()) {
                <ion-select
                (ngModelChange)="this.articulos.reload()"
                [(ngModel)]="this.params['id_categoria']"
                name="id_categoria"
                label="Categorias"
                label-placement="stacked"
                type="select"
                class="w-1/3" 
                >
                    <ion-select-option [value]="null">Todos</ion-select-option>
                    @for (categoria of categorias.value(); track $index) {
                        <ion-select-option [value]="categoria.id_categoria">{{ categoria.nombre }}</ion-select-option>
                    }
                </ion-select>
            }
        </div>
        <ion-searchbar color="light" name="searchbar" animated="true" placeholder="Buscar" [(ngModel)]="params['nombre']" (ngModelChange)="this.articulos.reload()"></ion-searchbar>
    </form>

    @if (articulos.hasValue()){
        @let arts = this.articulos.value();
        @if (arts.length !== 0) {
            <div class="grid max-w-full gap-3 grid-cols-1 md:grid-cols-2 lg:grid-cols-4 mt-6">
            @for (a of arts; track $index) {
                <a [routerLink]="['/articulos',a.id_articulo]">
                    <ion-card class="hover:cursor-pointer">
                        <div class="m-2">
                            <div class="aspect-3/2 w-full relative rounded-sm">
                                <img [src]="a.foto_url" class="aspect-3/2 object-cover overflow-hidden h-full w-full rounded-sm">
                                <div class="p-2 text-gray-50 rounded-br-sm text-xl w-fit absolute bottom-0 right-0 {{a.usado ? 'bg-green-800' : 'bg-blue-800'}}">
                                    {{a.usado ? 'Usado' : 'Nuevo'}}
                                </div>
                            </div>
                            <ion-card-title class="mt-2">
                                {{a.nombre}}
                            </ion-card-title>
                            <ion-card-subtitle>
                                <div>
                                    {{a.moneda}} {{a.precio}}
                                </div>
                            </ion-card-subtitle>
                        </div>
                    </ion-card>
                </a>
            }
            </div>
        }@else {
            <div class="h-full flex items-center justify-center">
                <div class="text-center">
                    <h1 class="text-5xl font-semibold tracking-tight text-balance text-white sm:text-7xl">Articulos no encontradaos</h1>
                    <p class="text-base font-semibold text-indigo-400">LO SENTIMOS</p>
                    <p class="mt-6 text-lg font-medium text-pretty text-gray-400 sm:text-xl/8">Parece que no hay articulos de los que estas buscando.</p>
                </div>
            </div>
        }
            
        } @else {
            @for (i of range(12); track $index) {
                <ion-card>
                        <div class="m-2">
                            <div class="aspect-square w-full rounded-sm bg-img flex justify-center items-center">
                                <ion-icon src="assets/icons/loading.svg" size="large" class="m-auto w-full h-1/5 animate-spin"></ion-icon>
                            </div>
                        </div>
                </ion-card>
            }
        }
   
</main>